---
title: 'Utilisation de la redondance en direct'
description: 'Les groupes redondants vous permettent de combiner 2 tâches en direct ou plus en un seul flux avec basculement automatique pour une lecture fiable et ininterrompue. Ce guide vous guidera à travers la création d'un groupe redondant, l'ajout de tâches et le forçage d'un basculement à l'aide de l'API Live.'
parent: Guides 
grandparent: Live API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Introduction">introduction</h2>
    
    <p>La fonction de redondance de Brightcove Live permet d'assurer des performances fiables pour vos événements en direct en créant un flux de sauvegarde vers lequel Live basculera automatiquement au cas où le premier flux cesserait de fonctionner.</p>
    
    <p>Notez que toutes les requêtes à l'API Live nécessitent les en-têtes suivants :</p>
    
    <table class="bcls-table">
      <caption class="bcls-caption--table">En-têtes de requête API</caption>
      <thead class="bcls-table__head">
        <tr>
          <th>Clé</th>
          <th>Valeur</th>
          <th>Remarques</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">X-API-KEY</code></td>
          <td>{your API Key}</td>
          <td>Votre clé doit avoir été fournie lorsque vous avez ouvert votre compte Brightcove Live</td>
        </tr>
        <tr>
          <td><code translate="No">Content-Type</code></td>
          <td>application/json</td>
          <td>Techniquement, le <code translate="No">content-type</code> L'en-tête n'est requis que pour les requêtes d'écriture qui incluent un corps de requête, mais ne devrait pas nuire aux requêtes de lecture.</td>
        </tr>
      </tbody>
    </table>
    </section>
    
    <section class="bcls-section">
    <h2 id="Create_your_Live_jobs">Créez vos emplois en direct</h2>
    
    <p>Pour la configuration redondante, vous devrez créer au moins 2 travaux Brightcove Live. La seule exigence des Jobs est qu'ils soient créés avec le <strong>même</strong> <code translate="No">output</code> Les paramètres. Le moyen le plus simple d'y parvenir est de créer un travail avec les spécifications de sortie souhaitées, puis d'utiliser le <code translate="No">copy_outputs_from_job</code> paramètre pour créer les tâches supplémentaires.</p>
    
    <p>Il n'y a aucune restriction sur les régions dans lesquelles ces emplois peuvent être créés, cependant, il est recommandé qu'ils soient situés relativement proches les uns des autres.</p>
    
    <p>Une fois les tâches en direct créées, conservez les ID de tâche pour plus tard. Le corps de la requête que vous utiliserez pour ajouter ces travaux à un groupe redondant (voir les sections ci-dessous) ressemblera à ceci :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">[
      {
        "job_id": "0b76bc73f92f46dc917bbe5061c0c633"
      },
      {
        "job_id": "0ae5a4a71dc54b3181af0f98ee407c27"
      }
    ]</code></pre>
    </section>
    
    <section class="bcls-section">
    <h2 id="Create_the_redundant_group">Créer le groupe redondant</h2>
    
    <p>Pour créer un groupe redondant, vous devrez soumettre un <code translate="No">POST</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups</code></pre>
    
    <p>Voici un exemple de corps de requête :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
      "ad_insertion": true,
      "processing_regions": ["us-west-2"],
      "storage_regions": ["us-west-2", "us-east-1"],
      "label": "Test RG",
      "live_dvr_sliding_window_duration": 1800
    }</code></pre>
    
    <p>Le tableau ci-dessous contient une liste complète des champs pour le corps de la demande. Dans plusieurs cas, ceux-ci sont identiques aux champs utilisés pour créer un travail réel. Voir le <a href="/live-api/references/reference.html">Référence de l'API en direct</a> pour plus de détails sur les champs.</p>
    
    <table class="bcls-table">
      <caption class="bcls-caption--table">Créer des champs de groupe redondants</caption>
      <thead class="bcls-table__head">
        <tr>
          <th>Champ</th>
          <th>Taper</th>
          <th>Obligatoire?</th>
          <th>La description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">ad_insertion</code></td>
          <td>booléen</td>
          <td>optionnel</td>
          <td>Définir sur true si ce flux doit être activé pour SSAI</td>
        </tr>
        <tr>
          <td><code translate="No">add_cdns</code></td>
          <td>déployer</td>
          <td>optionnel</td>
          <td>Tableau de fournisseurs CDN supplémentaires à utiliser pour la génération de manifeste. Pour chaque CDN fourni, le manifeste sera préfixé en conséquence</td>
        </tr>
        <tr>
          <td><code translate="No">drm</code></td>
          <td>objet</td>
          <td>optionnel</td>
          <td>Pas encore pris en charge</td>
        </tr>
        <tr>
          <td><code translate="No">encryption</code></td>
          <td>objet</td>
          <td>optionnel</td>
          <td>Pas encore pris en charge</td>
        </tr>
        <tr>
          <td><code translate="No">label</code></td>
          <td>chaîne de caractères</td>
          <td>obligatoire</td>
          <td>Une étiquette pour identifier le groupe</td>
        </tr>
        <tr>
          <td><code translate="No">live_dvr_sliding_window_duration</code></td>
          <td>entier</td>
          <td>optionnel</td>
          <td></td>
        </tr>
        <tr>
          <td><code translate="No">notifications</code></td>
          <td>déployer</td>
          <td>optionnel</td>
          <td>Tableau d'objets ou de chaînes de destination de notification</td>
        </tr>
        <tr>
          <td><code translate="No">processing_regions</code></td>
          <td>déployer</td>
          <td>obligatoire</td>
          <td>Régions de traitement pour le groupe redondant. Cela déterminera quelles régions AWS généreront les manifestes. Recommandé que cela corresponde à storage_regions et aux régions dans lesquelles les tâches en direct sont créées.</td>
        </tr>
        <tr>
          <td><code translate="No">storage_regions</code></td>
          <td>déployer</td>
          <td>obligatoire</td>
          <td>Les morceaux de médias et les listes de lecture des régions de stockage seront téléchargés dans S3. Il est recommandé que cela corresponde à processing_regions et aux régions dans lesquelles les tâches en direct sont créées.</td>
        </tr>
        <tr>
          <td><code translate="No">videocloud</code></td>
          <td>objet</td>
          <td>optionnel</td>
          <td>Les clients de Video Cloud ont la possibilité de créer une vidéo à utiliser pour la diffusion en direct.</td>
        </tr>
      </tbody>
    </table>
    
    <p>La réponse ressemblera à ceci :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
      "id": "481ff4cf0bf74956bc2ec6e126588080",
      "processing_regions": [
          {
              "region": "us-west-2",
              "probability": 1
          }
      ],
      "storage_regions": [
          "us-west-2",
          "us-east-1"
      ],
      "jobs": [],
      "state": "standby",
      "label": "Test RG",
      "live_dvr_sliding_window_duration": 1800,
      "status": {
          "us-west-2": null
      },
      "ad_insertion": true,
      "outputs": {
          "playback_url": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/playlist.m3u8",
          "playback_url_dvr": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/playlist_dvr.m3u8",
          "ssai_playback_urls": {
              "26f8470f61374e608e27af9c1b3f7ff0": {
                  "playback_url": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/26f8470f61374e608e27af9c1b3f7ff0/playlist_ssaiM.m3u8",
                  "playback_url_dvr": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/26f8470f61374e608e27af9c1b3f7ff0/playlist_dvr_ssaiM.m3u8",
                  "description": "House Ads - 864b84f712ae40bca1510a8052b34312",
                  "type": "ads"
              }
      }
    }</code></pre>
    </section>
    <section class="bcls-section">
      <h2 id="get_redundant_group">Obtenez des groupes redondants</h2>
      <p>Vous pouvez obtenir tous les groupes redondants en soumettant un <code translate="No">GET</code> demande à:</p>
      <pre><code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups</code></pre>
      <p>Vous pouvez filtrer la réponse en utilisant le <code translate="No">state</code> param. Les valeurs autorisées sont :</p>
      <ul>
        <li><code translate="No">cancelled</code></li>
        <li><code translate="No">cancelling</code></li>
        <li><code translate="No">deleting</code></li>
        <li><code translate="No">disconnected</code></li>
        <li><code translate="No">failed</code></li>
        <li><code translate="No">finished</code></li>
        <li><code translate="No">finishing</code></li>
        <li><code translate="No">processing</code></li>
        <li><code translate="No">standby</code></li>
        <li><code translate="No">waiting</code></li>
      </ul>
      <p>Il y a aussi <code translate="No">page_size</code> paramètre qui peut être défini sur un nombre entier jusqu'à 1000. Le défaut <code translate="No">page_size</code> est de 10.</p>
      <p>La réponse ressemblera à ceci :</p>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "redundant_groups": [
    {
      "id": "91c268a6ec5240d79a6004f4ccf0dc6f",
      "account_id": "a95ac581551b4478b27910e5675db1f8",
      "user_id": "c2691d4d039040be96c190a949d754a7",
      "processing_regions": [
        {
          "region": "us-west-2",
          "probability": 1
        }
      ],
      "storage_regions": [
        "us-west-2",
        "us-east-1"
      ],
      "jobs": [],
      "state": "standby",
      "created_at": 1594316624287,
      "updated_at": 1594316624287,
      "label": "Test Redundant Group",
      "live_dvr_sliding_window_duration": 86400,
      "status": {
        "us-west-2": null
      },
      "outputs": {
        "playback_url": "https://bcovlive-a.akamaihd.net/r91c268a6ec5240d79a6004f4ccf0dc6f/us-west-2/NA/playlist.m3u8",
        "playback_url_dvr": "https://bcovlive-a.akamaihd.net/r91c268a6ec5240d79a6004f4ccf0dc6f/us-west-2/NA/playlist_dvr.m3u8"
      }
    },
    {
      "id": "279ac36e4b4d48a3abbd3e1f98cd57aa",
      "account_id": "a95ac581551b4478b27910e5675db1f8",
      "user_id": "c2691d4d039040be96c190a949d754a7",
      "processing_regions": [
        {
          "region": "us-west-2",
          "probability": 1
        }
      ],
      "storage_regions": [
        "us-west-2",
        "us-east-1"
      ],
      "jobs": [],
      "state": "standby",
      "created_at": 1594323207015,
      "updated_at": 1594323207015,
      "label": "Test Redundant Group2",
      "live_dvr_sliding_window_duration": 86400,
      "status": {
        "us-west-2": null
      },
      "outputs": {
        "playback_url": "https://bcovlive-a.akamaihd.net/r279ac36e4b4d48a3abbd3e1f98cd57aa/us-west-2/NA/playlist.m3u8",
        "playback_url_dvr": "https://bcovlive-a.akamaihd.net/r279ac36e4b4d48a3abbd3e1f98cd57aa/us-west-2/NA/playlist_dvr.m3u8"
      }
    }
  ]
}</code></pre>
    </section>
    <section class="bcls-section">
    <h2 id="Add_live_jobs_to_the_redundant_group">Ajouter des tâches en direct au groupe redondant</h2>
    
    <p>Après avoir créé un groupe redondant, vous pouvez y ajouter des travaux en envoyant un <code translate="No">POST</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}/jobs</code></pre>
    
    <p>Les identifiants de tâche en direct sont spécifiés dans le corps de la requête comme ceci :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">[
      {
        "job_id": "0b76bc73f92f46dc917bbe5061c0c633"
      },
      {
        "job_id": "0ae5a4a71dc54b3181af0f98ee407c27"
      }
    ]</code></pre>
    
    <p>Il existe quelques propriétés facultatives supplémentaires pour les objets de tâche - le tableau suivant montre tous les champs :</p>
    
    <table class="bcls-table">
      <caption class="bcls-caption--table">Ajouter des champs de demande de travaux en direct</caption>
      <thead class="bcls-table__head">
        <tr>
          <th>Champ</th>
          <th>Taper</th>
          <th>Obligatoire?</th>
          <th>La description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">job_id</code></td>
          <td>chaîne de caractères</td>
          <td>obligatoire</td>
          <td>ID du travail à ajouter au groupe. Si ni l'un ni l'autre <code translate="No">playlist</code> ou <code translate="No">streams</code> sont spécifiés, tous <code translate="No">outputs</code> sera utilisé.</td>
        </tr>
        <tr>
          <td><code translate="No">playlist</code></td>
          <td>chaîne de caractères</td>
          <td>optionnel</td>
          <td>Libellé de la liste de lecture à utiliser comme sorties pour le flux. Si <code translate="No">playlist</code> est défini, <code translate="No">streams</code> <strong>doit</strong> être <em>indéfini</em>.</td>
        </tr>
        <tr>
          <td><code translate="No">streams</code></td>
          <td>déployer</td>
          <td>optionnel</td>
          <td>Liste des étiquettes de flux à utiliser comme sorties pour le flux. Si <code translate="No">streams</code> est défini, <code translate="No">playlist</code> <strong>doit</strong> être <em>indéfini</em>.</td>
        </tr>
      </tbody>
    </table>
    
    <p>La réponse de succès pour cette demande renverra simplement l'ID de groupe redondant.</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="Get_Redundant_Group_Status">Obtenir le statut de groupe redondant</h2>
    
    <p>Vous pouvez obtenir le statut de Groupe redondant en soumettant un <code translate="No">GET</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}</code></pre>
    
    <p>La réponse ressemblera à ce qui suit :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
      "id": "481ff4cf0bf74956bc2ec6e126588080",
      "processing_regions": [
          {
              "region": "us-west-2",
              "probability": 1
          }
      ],
      "storage_regions": [
          "us-west-2",
          "us-east-1"
      ],
      "jobs": [
          {
              "job_id": "0b76bc73f92f46dc917bbe5061c0c633",
              "streams": [
                  "hls720p",
                  "hls540p",
                  "hls360p"
              ],
              "state": "processing"
          },
          {
              "job_id": "0ae5a4a71dc54b3181af0f98ee407c27",
              "streams": [
                  "hls720p",
                  "hls540p",
                  "hls360p"
              ],
              "state": "processing"
          }
      ],
      "state": "processing",
      "created_at": 1568057414849,
      "updated_at": 1568059153017,
      "label": "Test RG",
      "live_dvr_sliding_window_duration": 1800,
      "status": {
          "us-west-2": {
              "SwitchDrift": 0,
              "Ended": false,
              "OnAir": "0b76bc73f92f46dc917bbe5061c0c633",
              "Mode": "auto",
              "InManifest": true,
              "MediaSequence": 10,
              "Healthiness": 0,
              "Duration": 4,
              "DiscontinuitySequence": 1,
              "SourceChunk": {
                  "MediaSequence": 3639,
                  "Duration": 4,
                  "DiscontinuitySequence": 0,
                  "ProgramDateTime": "2019-09-09T19:59:36Z",
                  "LiveJobID": "0b76bc73f92f46dc917bbe5061c0c633"
              },
              "UpdatedAt": "2019-09-09T19:59:46Z",
              "ProgramDateTime": "2019-09-09T19:59:36Z"
          }
      },
      "ad_insertion": true,
      "outputs": {
          "playback_url": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/playlist.m3u8",
          "playback_url_dvr": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/playlist_dvr.m3u8",
          "ssai_playback_urls": {
              "26f8470f61374e608e27af9c1b3f7ff0": {
                  "playback_url": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/26f8470f61374e608e27af9c1b3f7ff0/playlist_ssaiM.m3u8",
                  "playback_url_dvr": "https://playback-qa.a-live.io/r481ff4cf0bf74956bc2ec6e126588080/us-west-2/NA/26f8470f61374e608e27af9c1b3f7ff0/playlist_dvr_ssaiM.m3u8",
                  "description": "House Ads - 864b84f712ae40bca1510a8052b34312",
                  "type": "ads"
              }
          }
      }
    }</code></pre>
    
    <p>Chaque région de traitement du groupe redondant aura sa propre <code translate="No">status</code> objet, codé par région. Vous pouvez voir dans cet exemple que dans le <code translate="No">us_west_2</code> région de transformation, la <code translate="No">on_air</code> le travail est <code translate="No">0b76bc73f92f46dc917bbe5061c0c633</code>.</p>
    
    <p>En remarque, le <code translate="No">probability</code> associé à la région de traitement sera toujours à ce stade <code translate="No">1</code> , mais est inclus dans le modèle de données pour les améliorations futures qui permettront plusieurs régions de traitement avec des probabilités comprises entre 0 et 1, représentant le pourcentage approximatif du trafic de lecture qui utilisera cette région.</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="add_cuepoints">Ajout manuel de points de repère</h2>
    
    <p>L'ajout manuel de points de repère à un flux en direct avec redondance est très similaire à l'ajout de points de repère à un flux en direct ordinaire. Pour ce faire pour un groupe redondant, faites un <code translate="No">POST</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}/cuepoint</code></pre>
    
    <p>Incluez un corps de requête comme celui-ci :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
      "ad_server_data": {
        "subject": "wildlife"
      },
      "duration": 30,
      "timecode": "09:23:18:05"
    }</code></pre>
    
    <p>Si vous omettez le <code translate="No">timecode</code> champ, le point de repère sera inséré immédiatement.</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="Force_a_Job_failover">Forcer un basculement de tâche</h2>
    
    <p>Le basculement sera géré automatiquement par le système Brightcove Live et ne devrait nécessiter aucune intervention de votre part. Si, pour une raison quelconque, vous souhaitez forcer le basculement vers une autre tâche, le moyen le plus simple de le faire est d'arrêter simplement l'encodeur du <code translate="No">on_air</code> travail.</p>
    
    <p>Vous pouvez également forcer le basculement à l'aide de l'API en effectuant un <code translate="No">PUT</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}/switch</code></pre>
    
    <p>Le corps de la requête ressemble à ceci :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
      "mode": "manual",
      "on_air": "0ae5a4a71dc54b3181af0f98ee407c27"
    }</code></pre>
    
    <p>Ici, <code translate="No">mode</code> sera soit <code translate="No">manual</code> ou <code translate="No">auto</code> (la valeur par défaut) et le <code translate="No">on_air</code> aura une valeur de l'un des <strong>secondaire</strong> identifiants de travail.</p>
    
    <p>Noter: Une fois dans <code translate="No">manual</code> mode, le basculement automatique des tâches <strong>ne pas</strong> se produire. Tu <strong>doit</strong> remettre le mode sur <code translate="No">auto</code> pour que le basculement automatique reprenne. Vous pouvez modifier le travail à l'antenne sans passer en mode manuel en omettant le mode du corps et en ajoutant le paramètre de requête de force <code translate="No">?force=true</code> à votre demande. Cela forcera le service à changer de tâche, mais il peut revenir à tout moment s'il détecte des problèmes.</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="Ending_a_redundant_stream">Mettre fin à un flux redondant</h2>
    
    <p>Il existe deux manières de mettre fin à votre flux redondant. De par leur conception, les groupes redondants sont implicitement <a href="/live-api/guides/live-api-static-entry-points.html">SEP</a> ruisseaux. Vous pouvez mettre un groupe redondant dans <code translate="No">STANDBY</code> en supprimant tous les Jobs du Groupe redondant.</p>
    
    <p>Pour ce faire à l'aide d'un <code translate="No">DELETE</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}/jobs/{job_id}</code></pre>
    
    <p>pour chaque tâche que vous souhaitez supprimer. Notez que pour supprimer le travail actuellement <code translate="No">on_air</code> , vous devrez ajouter le <code translate="No">?force-true</code> paramètre de requête.</p>
    
    <p>La deuxième façon de terminer le flux consiste à supprimer complètement le groupe redondant en envoyant un <code translate="No">DELETE</code> demande à:</p>
    
    <pre>
    <code class="language-http" translate="No">https://api.bcovlive.io/v1/redundantgroups/{redundant_group_id}</code></pre>
    </section>
    <section class="bcls-section">
      <h2 id="limitations">Limites</h2>
      <ul>
        <li>Redondance en direct <strong>ne peut pas</strong> être utilisé avec des flux en direct protégés par DRM.</li>
      </ul>
    </section>
        </article>
    
 