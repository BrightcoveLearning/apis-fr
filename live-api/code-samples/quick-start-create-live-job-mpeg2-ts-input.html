---
title: 'Démarrage rapide: Créer une tâche en direct pour l'entrée MPEG2-TS'
description: 'Ce didacticiel vous guide à travers la création d'un travail en direct qui accepte l'entrée MPEG2-TS. Le travail est créé à l'aide de l'API Live.'
parent: Code Samples 
grandparent: Live API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">Aperçu</h2>

<figure class="bcls-figure"><img alt="general-block-diagram" src="/assets/images/live-api/18727/block-diagram-small.png" />Diagramme</figure>

<p>Ce tutoriel explique au niveau de l'API comment créer une tâche de streaming en direct dans <a href="/live-api/index.html">Brightcove en direct</a> qui accepte l'entrée MPEG2-TS. La clé pour utiliser l'entrée MPEG2-TS est de sélectionner un <code translate="No">protocol</code> qui prend en charge MPEG2-TS et que votre encodeur peut fournir. Les protocoles compatibles TS pris en charge par l'API Live sont :</p>

<ul>
	<li><code translate="No">rtp</code></li>
	<li><code translate="No">rtp-fec</code></li>
	<li><code translate="No">srt</code></li>
</ul>

<p>L'un de ces protocoles doit être spécifié explicitement pour utiliser l'entrée TS, car le protocole d'entrée par défaut est <code translate="No">rtmp</code>.</p>

<p>Pour utiliser les codes temporels SMPTE pour l'écrêtage, les points de repère SSAI ou les balises ID3, ils doivent être insérés dans la vidéo H.264 (AVC) dans les messages SEI Picture Timing.</p>

<p>N'oubliez pas que ces protocoles utilisent UDP (User Datagram Protocol) plutôt que TCP pour la communication entre l'encodeur et Live, donc votre pare-feu/routeur doit être configuré correctement et autoriser les sorties UDP vers Internet à partir de l'IP de l'encodeur.</p>

<aside class="bcls-aside bcls-aside--information">Notez que si vous avez des ports ouverts sur un réseau local, Brightcove alloue des ports de manière dynamique pour chaque tâche SRT et RTP, qui peut aller de 10 000 à 65535.</aside>

<p>Si vous utilisez <code translate="No">rtp-fec</code> , les informations FEC sont envoyées sur un port différent de celui du support, donc, par exemple, si vous utilisez le port 2000, vous devrez également ouvrir les ports 2002 et 2004 (si vous utilisez FEC 2D).</p>

<p>Ce tutoriel utilisera <a translate="No" href="https://general.support.brightcove.com/developer/concepts-set-curl.html">boucle</a> pour faire les requêtes API, mais vous pouvez facilement les faire dans <a translate="No" href="https://apis.support.brightcove.com/general/use-insomnia-api-requests.html">Insomnie</a> , <a translate="No" href="https://apis.support.brightcove.com/general/use-postman-api-requests.html">Facteur</a> ou d'autres clients REST à la place.</p>
</section>

<section class="bcls-section">
<h2 id="create_a_live_job">Créer un emploi en direct</h2>

<p>Tout d'abord, nous allons créer un emploi réel. Vous aurez besoin d'un <code translate="No">API-KEY</code> pour l'API en direct. Si ce n'est pas le cas et que vous souhaitez obtenir un accès, veuillez contacter votre gestionnaire de compte.</p>

<ol class="bcls-tasklist-restart">
	<li>
	<p>Copiez et collez ce qui suit <span translate="No">boucle</span> commande dans un éditeur de texte :</p>

	<pre class="line-numbers">
  <code class="language-bash" translate="No">curl -X POST \
    https://api.bcovlive.io/v1/jobs \
    -H 'Content-Type: application/json' \
    -H 'x-api-key: <span class="bcls-input">{{bcov-live-api-key}}</span>' \
    -d '{
      "live_stream": true,
      "region": "<span class="bcls-input">{{closest_aws_region}}</span>",
      "protocol": "<span class="bcls-input">{{your_protocol}}</span>",
      "cidr_whitelist": ["<span class="bcls-input">{{your_encoder_IPrange}}</span>", "<span class="bcls-input">{{your_backup_encoder_IPrange}}</span>"],
      "outputs": [{
          "label": "hls360p",
          "live_stream": true,
          "height": 360,
          "video_bitrate": 365,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls432p",
          "live_stream": true,
          "height": 432,
          "video_bitrate": 730,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls540p",
          "live_stream": true,
          "height": 540,
          "video_bitrate": 2000,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls720p3M",
          "live_stream": true,
          "height": 540,
          "video_bitrate": 2000,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls720p4.5M",
          "live_stream": true,
          "height": 720,
          "video_bitrate": 4500,
          "segment_seconds": 6,
          "keyframe_interval": 60
     }]
  }'</code></pre>
	</li>
	<li>
	<p><strong>Effectuez les remplacements suivants :</strong></p>

	<ul>
		<li><code translate="No">{{bcov-live-api-key}}</code> avec votre clé API live Brightcove. Par exemple: <code translate="No">abcdfeg-this-is-a-fake-api-key-FgJajjasd12hJHsZ</code></li>
		<li><code translate="No">{{closest_aws_region}}</code> avec la région disponible la plus proche de votre encodeur, voir <a href="/live-api/getting-started/overview-brightcove-live-api.html#Support_aws_regions">régions disponibles les plus proches</a> à votre encodeur. Par exemple: <code translate="No">us-west-2</code></li>
		<li><code translate="No">{{your_protocol}}</code> avec le protocole d'entrée que votre encodeur fournira : <code translate="No">rpt</code> , <code translate="No">rtp-fec</code> , ou <code translate="No">srt</code></li>
		<li><code translate="No">{{your_encoder_IPrange}}</code> avec la plage IP que votre encodeur utilisera, sous la forme de <code translate="No">1.2.3.4/32</code></li>
		<li><code translate="No">{{your_backup_encoder_IPrange}}</code>(le cas échéant) avec la plage IP que votre encodeur de secours utilisera, sous la forme de <code translate="No">1.2.3.4/32</code></li>
	</ul>
	</li>
	<li>Après avoir apporté ces modifications, copiez et collez le code dans Terminal ou dans l'application de ligne de commande que vous utilisez et exécutez-le.</li>
	<li>
	<p>La réponse devrait être quelque chose comme ceci si vous utilisez le <code translate="No">rtp-fec</code> protocole:</p>

	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "id": "42c913e5373844a99a6285367f2704ec",
      "outputs": [... removed for simplicity ...],
      "stream_url": "<span class="bcls-highlight">rtp:</span>//ec2-34-212-0-224.us-west-2.compute.amazonaws.com:12675",
      "stream_name": "42c913e5373844a99a6285367f2704ec.stream",
      "static": false,
      "encryption": {},
      "playback_url": "https://bcovlive-a.akamaihd.net/42c913e5373844a99a6285367f2704ec/us-west-2/NA/playlist.m3u8",
      "playback_url_dvr": "https://bcovlive-a.akamaihd.net/42c913e5373844a99a6285367f2704ec/us-west-2/NA/playlist_dvr.m3u8"
  }</code></pre>

	<p>Ou comme ça pour <code translate="No">srt</code>:</p>

	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "id": "cdb820f2d7764b91a79536dac799fb77",
      "outputs": [... removed for simplicity ...],
      "stream_url": "srt://ec2-34-212-0-224.us-west-2.compute.amazonaws.com:13820",
      "stream_name": "cdb820f2d7764b91a79536dac799fb77.stream",
      "static": false,
      "encryption": {},
      "playback_url": "https://bcovlive-a.akamaihd.net/cdb820f2d7764b91a79536dac799fb77/us-west-2/NA/playlist.m3u8",
      "playback_url_dvr": "https://bcovlive-a.akamaihd.net/cdb820f2d7764b91a79536dac799fb77/us-west-2/NA/playlist_dvr.m3u8"
  }</code></pre>
	</li>
</ol>

<aside class="bcls-aside bcls-aside--information">Notez que le port (13820 dans l'exemple ci-dessus) pour le flux SRT est unique pour chaque tâche, et vous devez l'obtenir à partir de la réponse à la demande de création de tâche !</aside>

<p>Ce travail créera 5 rendus <strong>basé</strong> au <a href="https://developer.apple.com/documentation/http_live_streaming/hls_authoring_specification_for_apple_devices">Recommandations Apple</a>.</p>
</section>

<section class="bcls-section">
<h2 id="Configure_your_encoder_ts">Configurez votre encodeur (TS+FEC)</h2>

<p>Les étapes indiquées ici supposeront une <a href="https://www.elemental.com/products/aws-elemental-live">Live box élémentaire</a> encodeur, qui a été utilisé pour tester les étapes de ce didacticiel. Si vous avez un autre encodeur, les paramètres doivent être similaires.</p>

<p>Les paramètres les plus importants pour cela <code translate="No">rtp-fec</code> les entrées sont :</p>

<ul>
	<li>Configurer la source du timecode en tant qu'"horloge système"</li>
	<li>Définissez « Correction d'erreur directe » sur « Colonne et ligne » et définissez les valeurs « Profondeur de colonne » et « Longueur de ligne » :
	<ul>
		<li><strong>Profondeur de la colonne :</strong> 4 (1 paquet FEC supplémentaire sera ajouté à chaque paquet TS "Column Depth")</li>
		<li><strong>Longueur de ligne :</strong> 10 (1 paquet FEC supplémentaire sera ajouté tous les paquets TS "Longueur de ligne")</li>
		<li>Des données supplémentaires ajoutées peuvent être calculées : TotalBitrate = MediaBitrate * (1/(ColumnDepth + 1) + 1/(RowLength + 1)</li>
	</ul>
	</li>
	<li>Vérifiez "l'insertion du code temporel" dans la vidéo</li>
	<li>Vivement recommandé: Framerate = suivre la source</li>
</ul>

<p>Voici la configuration que nous avons utilisée pour cet exemple TS+FEC :</p>

<figure class="bcls-figure"><img alt="elemental-live-job-config" title="Elemental live config" src="/assets/images/live-api/18727/elemental-live-job-config-fec-v1a.png" />
<figcaption class="bcls-caption--image">Configuration élémentaire en direct</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="Configure_your_encoder_srt">Configurez votre encodeur (SRT)</h2>

<p>La configuration présentée ici est basée sur un <a href="https://www.haivision.com/products/kb-series/">Haivision KB</a> encodeur, qui a été utilisé pour tester les étapes de ce didacticiel. Si vous avez un autre encodeur, les paramètres doivent être similaires.</p>

<p>Voici la configuration que nous avons utilisée pour cet exemple SRT :</p>

<figure class="bcls-figure"><img alt="Haivision-live-job-config" title="Haivision live config" src="/assets/images/live-api/18727/haivision-kb-srt-config.png" />
<figcaption class="bcls-caption--image">Configuration en direct de Haivision</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="test_playback">Tester la lecture</h2>

<p>Vous pouvez utiliser ceci <a href="https://videojs.github.io/videojs-contrib-hls/">Page de démonstration VideoJS HLS</a> pour tester la lecture, collez simplement la valeur <code translate="No">playback_url</code> renvoyé dans la réponse de la tâche de création :</p>

<figure class="bcls-figure"><img alt="videojs-hls-playback" title="VideoJS HLS playback demo page" src="/assets/images/live-api/18727/videojs-hls-playback-small.png" />
<figcaption class="bcls-caption--image">Page de démonstration de lecture VideoJS HLS</figcaption>
</figure>
</section>
</article>