---
title: 'Notifications d'ingestion dynamique'
description: 'Dans cette rubrique, vous découvrirez les notifications d'ingestion dynamique, qui fournissent des informations sur la progression de vos tâches d'ingestion. Notez que ce document s'applique uniquement au système d'acquisition hérité - pour la livraison dynamique, voir <a href="/dynamic-ingest/general/notifications-dynamic-delivery-video-cloud.html">Notifications pour l'ingestion dynamique</a> '

parent: 'General Information' 
grandparent: <span translate="No">API d'ingestion dynamique</span> Disposition héritée : mise en scène
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
    <section class="bcls-section">
    <h2 id="diAPI">Notifications d'API d'ingestion dynamique</h2>
    
    <p>Vous pouvez spécifier une ou plusieurs URL de rappel pour recevoir des notifications des résultats du processus d'ingestion. Les URL que vous spécifiez doivent être destinées aux applications pouvant accepter les requêtes POST. Les notifications seront envoyées au format JSON.</p>
    
    <aside class="bcls-aside bcls-aside--information">
    <h3>Remarques</h3>
    
    <ul>
      <li>Jusqu'à 10 abonnés pour les notifications d'erreurs sont pris en charge. Vous pouvez inclure plus de 10 URL auxquelles envoyer les notifications, mais seules les 10 premières seront traitées</li>
      <li>Les URL se terminant par une barre oblique (/) ne seront pas acceptées ; par exemple, l'url "https://my.domain.com/notification-receiver" fonctionne, mais "https://my.domain.com/notification-receiver/" ne fonctionne pas</li>
      <li>Alternativement, vous pouvez utiliser le <a href="/cms/references/reference.html#api-videoGroup-Get_Status_of_Ingest_Jobs">API d'état de l'API CMS</a> pour obtenir l'état des tâches d'ingestion pour une vidéo particulière.</li>
      <li>Les gestionnaires de notifications sur les serveurs construits sur HTTP2 ne sont actuellement pas pris en charge. Les notifications envoyées aux serveurs HTTP2 peuvent ne pas être livrées sans renvoyer d'erreur.</li>
    </ul>
    </aside>
    
    <h3>Installer</h3>
    
    <p>Voici un exemple.</p>
    
    <ul>
      <li>Utilisateur avec l'identifiant de pub 57838016001</li>
      <li>Veut utiliser Dynamic Ingest pour télécharger un fichier vidéo source situé sur https://s3.amazonaws.com/bucket/mysourcevideo.mp4</li>
      <li>Veut télécharger un titre existant dans le catalogue avec l'ID vidéo 5199670523001</li>
      <li>Utilisation du profil haute résolution</li>
      <li>Veut recevoir des rappels sur deux points de terminaison situés respectivement à http://host1/path1 et http://host2/path2</li>
    </ul>
    
    <p>La requête DI ressemblerait à ceci :</p>
    
    <h4>Demande POST</h4>
    <textarea class="bcls-code">https://ingest.api.brightcove.com/v1/accounts/57838016001/videos/5199670523001/ingest-requests</textarea>
    
    <h4>Corps de la demande</h4>
    <textarea class="bcls-code" style="height:10em;">{ "master": { "url": "https://s3.amazonaws.com/bucket/mysourcevideo.mp4" }, "profile": "haute résolution", "callbacks": ["http://host1/path1", "http://host2/path2"] }
        </textarea>
    
    <h3>Exemple de notification</h3>
    
    <p>Les notifications sont envoyées en tant que requêtes POST avec la notification dans le corps de la requête en tant que JSON <sup> <strong> <a href="#note1">[1]</a> </strong> </sup>. Voici quelques exemples de notification :</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
        "accountId": "57838016001",
        "entityType": "ASSET",
        "version": "1",
        "status": "SUCCESS",
        "videoId": "5199670523001",
        "entity": "5199679295001",
        "action": "CREATE",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "action": "CREATE",
        "status": "SUCCESS",
        "entityType": "DIGITAL_MASTER",
        "videoId": "5199670523001",
        "entity": "5199670523001",
        "accountId": "57838016001",
        "version": "1",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "entityType": "ASSET",
        "status": "SUCCESS",
        "action": "CREATE",
        "entity": "5199680423001",
        "profileRefId": "ts7",
        "version": "1",
        "accountId": "57838016001",
        "videoId": "5199670523001",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd",
        "accountId": "57838016001",
        "version": "1",
        "status": "SUCCESS",
        "entityType": "TITLE",
        "entity": "5199670523001",
        "videoId": "5199670523001",
        "action": "CREATE"
    }</code></pre>
    
    <h4>Remarques</h4>
    
    <ul>
      <li id="note1"><sup>[1]<strong></strong> </sup> Exception: Toutes les notifications pour le contenu packagé par DRM sont renvoyées sous forme de paires clé/valeur. Dans ce cas, le <code translate="No">Content-Type</code> l'en-tête sera <code translate="No">application/x-www-form-urlencoded</code>. Sinon, le <code translate="No">Content-Type</code> sera <code translate="No">application/json</code></li>
    </ul>
    
    <h3>Champs de notification</h3>
    
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Article</th>
          <th>La description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">status</code></td>
          <td>sera <code translate="No">FAILED</code> si l'acquisition ou la création d'un rendu n'a pas abouti, <code translate="No">SUCCESS</code> si la demande aboutit</td>
        </tr>
        <tr>
          <td><code translate="No">accountId</code></td>
          <td>l'identifiant du compte</td>
        </tr>
        <tr>
          <td><code translate="No">videoId</code></td>
          <td>l'identifiant de la vidéo</td>
        </tr>
        <tr>
          <td><code translate="No">jobId</code></td>
          <td>l'identifiant de la tâche pour la demande d'ingestion dynamique</td>
        </tr>
        <tr>
          <td style="vertical-align:top;"><code translate="No">profileRefId</code></td>
          <td>
          <p>Pour les rendus vidéo, ce sera le <code translate="No">reference id</code> vous avez spécifié pour le rendu dans votre profil d'ingestion.</p>
    
          <p>Pour les manifestes, le <code translate="No">profileRefId</code> indiquera le type du manifeste :</p>
    
          <ul>
            <li><code translate="No">HlsManifest</code> pour un manifeste HLS NG</li>
            <li><code translate="No">HdsManifest</code> pour un manifeste HDS</li>
            <li><code translate="No">DashManifest</code> pour les manifestes DASH (2 - l'un des actifs Manifest est utilisé pour la consommation dans le MAPI, l'autre est utilisé pour la consommation dans l'API CMS)</li>
            <li><code translate="No">SmoothIsmManifest</code> pour un manifeste Smooth (2 - l'un des actifs Manifest est utilisé pour la consommation dans le MAPI, l'autre est utilisé pour la consommation dans l'API CMS)</li>
          </ul>
          </td>
        </tr>
        <tr>
          <td><code translate="No">entity</code></td>
          <td>s'il existe, l'identifiant Video Cloud de l'asset qui a été ingéré ou a échoué (si l'objet vidéo a été créé avec succès dans Video Cloud)</td>
        </tr>
        <tr>
          <td><code translate="No">entityType</code></td>
          <td>le type d'actif faisant l'objet de la déclaration - par exemple : TITLE (une vidéo), DIGITAL_MASTER, ASSET (un rendu, un fichier de sous-titres ou une image)</td>
        </tr>
        <tr>
          <td><code translate="No">errorMessage</code></td>
          <td>une explication de la raison pour laquelle l'ingestion a échoué si elle l'a fait</td>
        </tr>
        <tr>
          <td><code translate="No">version</code></td>
          <td>une chaîne toujours égale à <code translate="No">"1"</code></td>
        </tr>
        <tr>
          <td><code translate="No">action</code></td>
          <td>l'action qui s'est produite - par exemple, CREATE</td>
        </tr>
      </tbody>
    </table>
    
    <h3>Interprétation des notifications</h3>
    
    <p>Une notification contenant <code translate="No">"action": "CREATE"</code> et <code translate="No">"status": "SUCCESS"</code> indique l'achèvement d'un processus.</p>
    
    <ul>
      <li>Si la <code translate="No">entityType</code> est <code translate="No">TITLE</code> , le traitement d'une vidéo ingérée est terminé.</li>
      <li>Si la <code translate="No">entityType</code> est <code translate="No">ASSET</code> , un rendu, une image, un manifeste ou un fichier WebVTT a été ajouté avec succès à votre vidéo.</li>
    </ul>
    
    <p class="BCL-aside">Pas de thé <code translate="No">"status": "SUCCESS"</code> sur un <strong>Titre</strong> indique que le traitement est terminé, mais ne signifie pas nécessairement que tous les rendus ont été créés avec succès. Pour déterminer si l'intégration dynamique des vidéos a réussi, consultez <a href="/dynamic-ingest/general/get-status-dynamic-ingest-requests-dynamic-delivery.html">Obtenir l'état des demandes d'ingestion dynamique</a></p>
    </section>
    
    <section class="bcls-section">
    <h2 id="sampleApp">Exemple d'application de base</h2>
    
    <p>Vous trouverez ci-dessous le code d'une application de journalisation simple pour <span translate="No">API d'ingestion dynamique</span> notification. Cette application est écrite en PHP, mais vous pouvez utiliser n'importe quel langage, tant que l'application dispose d'une URL publique et peut gérer les requêtes POST http(s).</p>
    
    <p>Vous pouvez voir le fichier journal que cette application génère <a href="//solutions.brightcove.com/bcls/di-api/di-log.txt">ici.</a></p>
    
    <p class="BCL-aside">Remarque : si vous essayez d'implémenter cette application pour vous-même, vous devrez vous assurer que l'application est autorisée à écrire dans votre fichier journal. N'oubliez pas non plus que le fichier journal peut croître rapidement - vous voudrez probablement le vider régulièrement.</p>
    
    <pre class="line-numbers">
    <code class="language-php">&lt;?php // POST ne fonctionnera pas pour les données JSON $problem = "No error"; essayer { $json = file_get_contents('php://input'); $decoded = json_decode($json, true); } capture (Exception $e) { $problem = $e-&gt;getMessage(); } // transforme la notification en JSON assez imprimé $notification = json_encode($decoded, JSON_PRETTY_PRINT); $logEntry = $notification. "\\nErreurs lors de la réception des notifications : ".$problem. "\\n-------------------------------\\n" ; // Enfin, dites à PHP où il peut trouver le fichier journal et dites à PHP de l'ouvrir // et ajoutez-y la chaîne que nous avons créée précédemment. $logFileLocation = "di-log.txt" ; $fileHandle = fopen($logFileLocation, 'a') ou die("-1"); fwrite($fileHandle, $logEntry); fclose($fileHandle); // la ligne ci-dessous s'affiche lorsque vous parcourez l'application directement echo "L'application de rappel Dynamic Ingest est en cours d'exécution" ; ?&gt; </code></pre>
    </section>
    </article>
 