---
title: 'Générateur de plan de site vidéo'
description: 'Cet exemple montre comment générer un plan de site vidéo à l'aide de l'API CMS.'

parent: 'Code Samples' 
grandparent: CMS API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Introduction">introduction</h2>

    <aside class="bcls-aside bcls-aside--information">Cet exemple et le code associé sont fournis comme guide pour le développement de votre production. Le code n'est pas certifié pour une utilisation en production ni officiellement pris en charge.</aside>

    <p>Avant d'utiliser cette application, vous devez lire <a href="https://studio.support.brightcove.com/general/making-your-video-content-indexable.html">Rendre votre contenu vidéo indexable</a> pour mieux comprendre le but des plans de site vidéo et les stratégies pour automatiser leur génération à l'aide de l'API CMS. La génération du XML pour le plan du site est assez simple. Le plus grand défi est que vous devez inclure une URL unique pour chaque vidéo, et le <span translate="No">API CMS</span> n'a pas automatiquement accès à ces informations. Pour surmonter cela, vous pouvez faire plusieurs choses :</p>

    <ol>
      <li>Ajoutez l'URL où la vidéo est publiée aux métadonnées de la vidéo. La façon la plus simple de le faire serait de créer un <a href="https://studio.support.brightcove.com/admin/creating-custom-metadata-fields.html">champ de métadonnées personnalisé</a> pour stocker l'URL.</li>
      <li>Hébergez les vidéos sur une seule page, en utilisant un paramètre d'URL pour spécifier la vidéo <code translate="No">id</code> ou <code translate="No">reference_id</code> que JavaScript personnalisé dans la page utilisera pour charger la vidéo dans le lecteur.
        <p>Il existe différentes manières d'obtenir la valeur d'un paramètre d'URL spécifique pour la page. Vous trouverez ci-dessous une fonction que nous utilisons dans certains de nos exemples d'applications :</p>

        <pre class="line-numbers">
            <code class="language-javascript" translate="No">/**
             * gets value of a URL param on current page URL if exists
             * @param {string} name the param you want the value of
             * @return {string} result value of param if exists or null
             */
            function getURLparam(name) {
                var regex,
                    results;
                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                results = regex.exec(location.search);
                return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
            }</code></pre>

        <p>Une fois que vous avez le <code translate="No">id</code> ou <code translate="No">reference_id</code> , vous devez l'ajouter au lecteur. La façon de procéder dépendra de l'utilisation ou non de la norme (<code translate="No">iframe</code> ) ou un code d'intégration de lecteur avancé (dans la page). La chose la plus simple et la plus sûre à faire est probablement&nbsp;à <a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">charger le lecteur dynamiquement</a> (ou pas, si pour une raison quelconque le paramètre d'URL avec l'identifiant n'est pas présent).</p>

        <p>Un exemple d'une seule page HTML qui peut être utilisée à cette fin est document dans le <a href="#Single_page">Une seule page</a> rubrique ci-dessous.</p>
      </li>
    </ol>

    <p>L'exemple d'application ci-dessous vous permet d'utiliser l'une ou l'autre méthode - il vous suffit de lui dire laquelle en saisissant les informations dans les champs appropriés.</p>

    <h3>Remarques sur l'exemple d'application :</h3>

    <ol>
      <li>L'application fait une demande au <span translate="No">API d'analyse</span> pour obtenir les vues vidéo de tous les temps, donc si les informations d'identification client que vous fournissez n'incluent pas les autorisations pour l'API Analytics, l'application échouera.</li>
      <li>Le nombre maximum de vidéos pouvant être incluses est de 50 000 et la taille du fichier est également limitée à 50 Mo, que vous pourriez atteindre avec moins de 50 000 vidéos. Si vous avez plus de vidéos que cela à inclure, vous devrez les diviser en plusieurs plans de site et ajouter un fichier d'index de plan de site. Voir <a href="https://support.google.com/webmasters/answer/80471">Documentation du plan du site de Google</a> pour plus d'informations.</li>
      <li>Le plan du site généré par l'exemple d'application n'inclut pas certaines des balises facultatives pour les vidéos (voir le document Google référencé ci-dessus pour plus d'informations à leur sujet). Si vous souhaitez les inclure, vous pouvez prendre le code de cette application et créer une version modifiée. Il y a des commentaires dans le code JavaScript et HTML pour indiquer ce que vous devez faire.
        <table class="bcls-table">
          <caption class="bcls-caption--table">Balises facultatives incluses ou non</caption>
          <thead class="bcls-table__head">
            <tr>
              <th>Étiquettes incluses</th>
              <th>Étiquettes non incluses</th>
            </tr>
          </thead>
          <tbody class="bcls-table__body">
            <tr>
              <td>
                <ul>
                  <li>player_loc</li>
                  <li>durée</li>
                  <li>date_expiration (le cas échéant)</li>
                  <li>nombre de vues</li>
                  <li>date de publication</li>
                  <li>conviviale et familiale</li>
                  <li>(géo) restriction (le cas échéant)</li>
                </ul>
              </td>
              <td>
                <ul>
                  <li>content_loc</li>
                  <li>évaluation</li>
                  <li>Plate-forme</li>
                  <li>le prix</li>
                  <li>nécessite_un abonnement</li>
                  <li>téléchargeur</li>
                  <li>habitent</li>
                  <li>étiqueter</li>
                  <li>Catégorie</li>
                  <li>galerie_loc</li>
                </ul>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Les vidéos seront ignorées si elles ne remplissent pas les conditions nécessaires, comme suit :
        <ul>
          <li>Si vous stockez l'URL de la page vidéo dans un champ personnalisé, toute vidéo qui n'a pas de valeur pour ce champ personnalisé</li>
          <li>Si vous utilisez une seule page pour héberger vos vidéos et que vous utilisez le <code translate="No">reference_id</code> pour les inclure, et la vidéo n'a pas <code translate="No">reference_id</code></li>
          <li>La vidéo n'a pas d'image miniature</li>
          <li>La vidéo n'a pas de rendu MP4</li>
          <li>La vidéo est inactive</li>
          <li>La vidéo devrait commencer à une date ultérieure</li>
          <li>La vidéo devait se terminer avant la date actuelle</li>
        </ul>

        <p>Notez que pour toute vidéo ignorée, j'enregistre un message dans la console du navigateur indiquant la raison et l'identifiant de la vidéo.</p>
      </li>
    </ol>

    <p>Enfin, si vous souhaitez valider votre sitemap après l'avoir généré, il existe plusieurs outils gratuits sur le web pour le faire - par exemple :</p>

    <p><a href="https://www.inspyder.com/free/SitemapValidator.aspx">Validateur de plan de site gratuit</a></p>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="getCredentials">Obtenir des informations d'identification</h2>
      </summary>

      <p>Pour utiliser le <span translate="No">API CMS</span> vous aurez besoin des informations d'identification appropriées.</p>

      <p>Le moyen le plus simple d'obtenir des informations d'identification dans la plupart des cas consiste à utiliser la section Authentification de l'API d'administration de Studio (nécessite des autorisations d'administrateur sur votre compte). Voir <a href="/general/managing-api-authentication-credentials.html">Gestion des informations d'authentification API</a> pour les détails. Dans la plupart des cas, vous souhaitez probablement simplement obtenir des autorisations pour tous <span translate="No">API CMS</span> opération:</p>

      <figure class="bcls-figure"><img class="bcls-image" alt="CMS API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/cms-api/cms-permissions.png" />
        <figcaption class="bcls-caption--image">Autorisations API CMS</figcaption>
      </figure>

      <p>Si les autorisations dont vous avez besoin ne sont pas disponibles dans Studio, ou si vous préférez les obtenir directement à partir de l'API OAuth, utilisez votre choix de <strong>Obtenir les informations d'identification du client</strong> documents énumérés ci-dessous. Quelle que soit l'option que vous choisissez, vous devrez demander les autorisations de fonctionnement correctes. Les éléments suivants peuvent être utilisés avec cURL, Postman ou notre application en ligne pour obtenir toutes les autorisations pour l'API CMS :</p>

      <pre class="line-numbers">
              <code class="language-json" translate="No">"operations": [
                "video-cloud/video/all",
                "video-cloud/playlist/all",
                "video-cloud/sharing-relationships/all",
                "video-cloud/notifications/all"
                "video-cloud/analytics/read"
              ]</code></pre>

      <ul>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-curl.html">OAuth : Obtenir les informations d'identification du client à l'aide de cURL</a></li>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-postman.html">OAuth : Obtenez les informations d'identification du client à l'aide de Postman</a></li>
        <li><a href="/oauth/code-samples/oauth-api-sample-create-client-credentials.html">Exemple d'API OAuth : Créer des informations d'identification client</a></li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="sampleApp">Exemple d'application</h2>
    <h3>Code source</h3>
    <p>Retrouvez tout le code associé à cet exemple dans ce <a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">Dépôt GitHub</a>.</p>
    <h3>Exemple d'application</h3>
    <p class="codepen" data-height="1200" data-theme-id="34967" data-default-tab="result" data-user="rcrooks1969" data-slug-hash="VRLNJp" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CMS API Sample: Video Sitemap Generator"><span>Voir le stylo <a href="https://codepen.io/team/rcrooks1969/pen/VRLNJp/"> <span translate="No">API CMS</span> Échantillon: Générateur de plan de site vidéo</a> par Brightcove Learning Services (<a href="https://codepen.io/rcrooks1969">@rcrooks1969</a> ) au <a href="https://codepen.io">Stylo de code</a>.</span></p>
    <script async="async" src="https://static.codepen.io/assets/embed/ei.js"></script>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="Using_the_CodePen">Utiliser le CodePen</h2>
      </summary>

      <p>Voici quelques conseils pour utiliser efficacement le CodePen ci-dessus :</p>

      <ul>
        <li>Basculez l'affichage réel du lecteur en cliquant sur le bouton <strong>Résultat</strong> bouton.</li>
        <li>Clique le <strong>HTML/CSS/JS</strong> pour afficher UN des types de code.</li>
        <li>Cliquez sur <strong>Modifier sur CodePen</strong> dans le coin supérieur droit pour insérer ce CodePen dans votre propre compte.</li>
        <li>Retrouvez tout le code associé à cet exemple dans ce <a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">Dépôt GitHub</a>.</li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="Single_page">Une seule page</h2>

    <p>Comme mentionné ci-dessus, vous pouvez créer une page HTML qui peut être utilisée pour l'emplacement de chaque vidéo. L'application modifiera l'URL de la page en utilisant un paramètre de requête qui définit l'ID vidéo que la page doit utiliser. Par exemple, l'application générera un JSON contenant des URL d'emplacement similaires aux suivantes pour l'emplacement des pages vidéo :</p>

    <pre class="line-numbers">
            <code class="language-json" translate="No">&lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5984663997001]]&gt;
            &lt;/loc&gt;
            ...
            &lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5982130568001]]&gt;
            &lt;/loc&gt;</code></pre>

    <p>Notez que seul l'ID de la vidéo change.</p>

    <p>La page HTML proprement dite lit le <strong>ID vidéo</strong> Le paramètre URL génère ensuite dynamiquement un lecteur à l'aide de l'ID vidéo obtenu à partir de l'URL. La page HTML entière apparaît comme suit :</p>

    <pre class="line-numbers">
            <code class="language-html" translate="No">&lt;!doctype html&gt;
            &lt;html&gt;
            
            &lt;head&gt;
              &lt;meta charset="UTF-8"&gt;
              &lt;title&gt;Load Player Dynamically from URL Param&lt;/title&gt;
              &lt;!-- Page styles --&gt;
              &lt;style&gt;
                .video-js {
                  width: 640px;
                  height: 360px;
                }
              &lt;/style&gt;
            &lt;/head&gt;
            
            &lt;body&gt;
              &lt;div id="placeHolder"&gt;&lt;/div&gt;
              &lt;!-- custom script --&gt;
              &lt;script type="text/JavaScript"&gt;
                var myPlayer,
                  playerHTML,
                  playerData = {},
                  theURLParam = '',
                  // Set the account ID to your account
                  myAccountId = '1507807800001';
            
                 // Read URL param for video ID
                theURLParam = geturlparam('videoId');
            
                // Assign data for the player instantiation
                playerData = {
                  'accountId': myAccountId,
                  'playerId': 'default',
                  'videoId': theURLParam
                };
            
                // Call function that builds player
                addPlayer();
            
                /**
                 * gets value of a url param on current page url if exists
                 * @param {string} name the param you want the value of
                 * @return {string} result value of param if exists or null
                 */
                function geturlparam(name) {
                  var regex,
                    results;
                  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                  regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                  results = regex.exec(location.search);
                  return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
                };
            
                // Dynamically adds player to page
                function addPlayer() {
                  // Dynamically build the player video element
                  playerHTML = '&lt;video-js id=\"myPlayerID\" data-video-id=\"' + playerData.videoId + '\"  data-account=\"' + playerData.accountId + '\" data-player=\"' + playerData.playerId + '\" data-embed=\"default\" class=\"video-js\" controls&gt;&lt;/video-js&gt;';
                  // Inject the player code into the DOM
                  document.getElementById('placeHolder').innerHTML = playerHTML;
                  // Add and execute the player script tag
                  var s = document.createElement('script');
                  s.src = "https://players.brightcove.net/" + playerData.accountId + "/" + playerData.playerId + "_default/index.min.js";
                  document.body.appendChild(s);
                  s.onload = callback;
                }
            
                 // Initialize the player and start the video
                function callback() {
                  myPlayer = bc('myPlayerID');
                  // Can also use the following to assign a player instance to the variable if you choose not to use IDs for elements directly
                  // myPlayer = bc(document.getElementById('myPlayerID'));
                  myPlayer.on('loadedmetadata', function () {
                    // Mute the audio track, if there is one, so video will autoplay on button click
                    myPlayer.muted(true);
                    myPlayer.play();
                  })
                }
              &lt;/script&gt;
            &lt;/body&gt;
            
            &lt;/html&gt;</code></pre>

    <p>Vous devrez entrer votre numéro de compte. Pour une explication complète du code, voir le <a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">Exemple de lecteur Brightcove : Chargement dynamique du lecteur</a> document.</p>
  </section>

    <section class="bcls-section">
    <details>
      <summary>
        <h2 id="proxy">Code proxy</h2>
      </summary>

      <p>Afin de créer votre propre version de l'exemple d'application sur cette page, vous devez créer et héberger votre propre proxy. (Les proxys utilisés par Brightcove Learning Services n'acceptent que les demandes des domaines Brightcove.) Un exemple de proxy, très similaire à celui que nous utilisons, mais sans les contrôles qui bloquent les demandes des domaines non Brightcove, peut être trouvé dans <a href="https://github.com/BrightcoveLearning/sample-proxy-apps">ce référentiel GitHub</a>. Vous y trouverez également des instructions de base pour l'utiliser et un guide plus élaboré pour créer des applications autour du proxy dans <a href="/getting-started/learning-guide-using-rest-apis.html">Utilisation des API REST</a>.</p>
    </details>
  </section>

</article>